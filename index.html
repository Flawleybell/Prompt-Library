<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Prompt Library</title>
  <style>
    :root { --border:#e5e7eb; --muted:#6b7280; --bg:#fff; --chip:#f3f4f6; --ink:#111827; }
    *{box-sizing:border-box}
    html,body,#root{height:100%}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--ink)}
    .container{max-width:1100px;margin:0 auto;padding:24px}
    .hstack{display:flex;align-items:center;gap:8px}
    .hstack-wrap{display:flex;flex-wrap:wrap;align-items:center;gap:8px}
    .spread{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .button{padding:8px 12px;border:1px solid var(--border);background:#fff;cursor:pointer;border-radius:6px}
    .button.primary{background:var(--ink);color:#fff;border-color:var(--ink)}
    .button.ghost{border-color:transparent;background:transparent;color:var(--ink);padding-left:0}
    .danger{border-color:#ef4444;color:#ef4444;background:#fff}
    .input,.select,.textarea{width:100%;padding:8px 10px;border:1px solid var(--border);border-radius:6px}
    .grid{display:grid;gap:16px}
    @media (min-width: 980px){ .grid.two{grid-template-columns:1fr 1fr} }
    .card{border:1px solid var(--border);border-radius:10px;background:#fff}
    .card .card-header{padding:12px 16px;border-bottom:1px solid var(--border)}
    .card .card-body{padding:16px}
    .badge{display:inline-block;background:var(--chip);padding:4px 8px;border-radius:999px;font-size:12px}
    .muted{color:var(--muted);font-size:12px}
    pre,code{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace}
    .clamp{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;white-space:pre-wrap}
    .chip-toggle { display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border:1px solid var(--border); border-radius:6px; cursor:pointer; }
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;padding:16px}
    .modal{max-width:760px;width:100%;background:#fff;border-radius:10px;border:1px solid var(--border);overflow:hidden}
    .modal .card-header{border-bottom:1px solid var(--border)}
  </style>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <script>
    (function() {
      var password = prompt("Enter password to view this page:");
      if (password !== "CIA123") {
        document.body.innerHTML = "<h2>Access denied</h2>";
      }
    })();
  </script>

  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useMemo, useState } = React;

    function uid(){ return `${Date.now().toString(36)}-${Math.random().toString(36).slice(2,10)}`; }

    const DEFAULT_CATEGORIES = ['IDV','Disputes','Vulnerability','Payments','Closures','Escalations','General'];
    const DEFAULT_CHANNELS = ['Front','ElevenLabs','Voice','Email','SMS','Chat'];
    const STORAGE_KEY = 'promptlib.v1.items';
    const CAT_KEY = 'promptlib.v1.categories';

    const STARTER_DATA = [
      { id: uid(), category: 'IDV', name: 'IDV – Standard', purpose: 'Confirm identity before account details.', prompt: 'For security, I need to confirm a few details before we continue. Could you please confirm your surname?', notes: 'Use after intro, before giving any account details.', tags: ['compliance', 'intro'], channels: ['Voice', 'Front'], createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() },
      { id: uid(), category: 'Disputes', name: 'Balance not recognised – holding', purpose: 'Acknowledge and move to dispute flow without defensiveness.', prompt: 'Thanks for letting me know. I won’t go into details until this is checked. I can raise a dispute so the team can investigate. Could you tell me briefly what doesn’t look right?', notes: 'Keep neutral; capture summary + evidence.', tags: ['dispute', 'holding'], channels: ['Voice', 'Chat'], createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() },
      { id: uid(), category: 'Vulnerability', name: 'TEXAS – consent line', purpose: 'Gain explicit consent to note circumstances.', prompt: 'So that we can support you in the best way going forward, would it be okay for us to make a note of your circumstances on your account? This information may be shared with {Client} and you can ask us to remove this information at any time, just let us know.', notes: 'Exact wording per internal guidance.', tags: ['vulnerability', 'consent', 'TEXAS'], channels: ['Voice', 'Front', 'Chat'], createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() }
    ];

    function exportJSON(filename, data) {
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
    }

    function importJSON(onData) {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = () => {
        const file = input.files && input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          try { onData(JSON.parse(String(reader.result))) } catch { alert('Invalid JSON file') }
        }
        reader.readAsText(file);
      };
      input.click();
    }

    function App() {
      const [items, setItems] = useState([]);
      const [categories, setCategories] = useState(DEFAULT_CATEGORIES);

      const [q, setQ] = useState('');
      const [catFilter, setCatFilter] = useState('All');
      const [tagFilter, setTagFilter] = useState('');
      const [channelFilter, setChannelFilter] = useState('');
      const [compact, setCompact] = useState(true);
      const [expandedIds, setExpandedIds] = useState([]);
      const [editing, setEditing] = useState(null);
      const [showEditor, setShowEditor] = useState(false);

      useEffect(() => {
        try {
          const saved = localStorage.getItem(STORAGE_KEY);
          setItems(saved ? JSON.parse(saved) : STARTER_DATA);
        } catch { setItems(STARTER_DATA); }
        try {
          const savedCats = localStorage.getItem(CAT_KEY);
          if (savedCats) setCategories(JSON.parse(savedCats));
        } catch {}
      }, []);

      useEffect(() => { localStorage.setItem(STORAGE_KEY, JSON.stringify(items)); }, [items]);
      useEffect(() => { localStorage.setItem(CAT_KEY, JSON.stringify(categories)); }, [categories]);

      const filtered = useMemo(() => {
        return items.filter(it => {
          if (catFilter !== 'All' && it.category !== catFilter) return false;
          if (tagFilter && !(it.tags||[]).includes(tagFilter)) return false;
          if (channelFilter && !(it.channels||[]).includes(channelFilter)) return false;
          if (q) {
            const hay = [it.name,it.prompt,it.purpose,it.notes,(it.tags||[]).join(' '),(it.channels||[]).join(' ')].join(' ').toLowerCase();
            if (!hay.includes(q.toLowerCase())) return false;
          }
          return true;
        });
      }, [items, catFilter, tagFilter, channelFilter, q]);

      function startNew(){
        setEditing({
          id: uid(),
          category: categories[0] || 'General',
          name: '',
          purpose: '',
          prompt: '',
          notes: '',
          tags: [],
          channels: [],
          createdAt: new Date().toISOString(),
          updatedAt: new Date().toISOString(),
        });
        setShowEditor(true);
      }
      function editItem(it){ setEditing({...it}); setShowEditor(true); }
      function saveEditing(){
        if(!editing) return;
        if(!editing.name?.trim()) return alert('Please enter a name');
        const exists = items.some(x => x.id === editing.id);
        const next = exists
          ? items.map(x => x.id === editing.id ? {...editing, updatedAt: new Date().toISOString()} : x)
          : [{...editing, createdAt: new Date().toISOString(), updatedAt: new Date().toISOString()}, ...items];
        setItems(next);
        setShowEditor(false);
        setEditing(null);
      }
      function duplicateItem(id){
        const it = items.find(x => x.id === id);
        if(!it) return;
        const copy = {...it, id: uid(), name: it.name + ' (copy)', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString()};
        setItems([copy, ...items]);
      }
      function deleteItem(id){
        if(!confirm('Delete this prompt?')) return;
        setItems(items.filter(x => x.id !== id));
      }
      function addCategory(){
        const name = prompt('New category name');
        if(!name) return;
        if(categories.includes(name)) return alert('Category already exists');
        setCategories([...categories, name]);
      }
      function importItems(){
        importJSON((data)=>{
          if(!Array.isArray(data)) return alert('Expected an array of prompts');
          const cleaned = data.map(d => ({
            id: d.id || uid(),
            category: d.category || 'General',
            name: d.name || 'Untitled',
            purpose: d.purpose || '',
            prompt: d.prompt || '',
            notes: d.notes || '',
            tags: Array.isArray(d.tags) ? d.tags : [],
            channels: Array.isArray(d.channels) ? d.channels : [],
            createdAt: d.createdAt || new Date().toISOString(),
            updatedAt: new Date().toISOString(),
          }));
          setItems(cleaned.concat(items));
        });
      }
      function exportAll(){ exportJSON('prompt-library.json', items); }
      function exportFiltered(){ exportJSON('prompt-library-filtered.json', filtered); }
      function toggleExpanded(id){
        setExpandedIds(prev => prev.includes(id) ? prev.filter(x=>x!==id) : [...prev, id]);
      }

      return (
        <div className="container">
          <div className="spread" style={{marginBottom:16}}>
            <div className="hstack">
              <h1 style={{margin:0}}>Prompt Library</h1>
              <label className="chip-toggle">
                <input type="checkbox" checked={compact} onChange={e=>setCompact(e.target.checked)}/>
                Compact view
              </label>
            </div>
            <div className="hstack-wrap">
              <button className="button" onClick={addCategory}>Add Category</button>
              <button className="button" onClick={importItems}>Import JSON</button>
              <button className="button" onClick={exportFiltered}>Export filtered</button>
              <button className="button primary" onClick={exportAll}>Export all</button>
              <button className="button" onClick={startNew}>New Prompt</button>
            </div>
          </div>

          {/* Filters */}
          <div className="card" style={{marginBottom:16}}>
            <div className="card-header"><div style={{fontWeight:600}}>Search &amp; Filter</div></div>
            <div className="card-body grid" style={{gridTemplateColumns:'2fr 1fr 1fr 1fr'}}>
              <input className="input" value={q} onChange={e=>setQ(e.target.value)} placeholder="Search name, purpose, prompt, notes, tags…"/>
              <select className="select" value={catFilter} onChange={e=>setCatFilter(e.target.value)}>
                <option>All</option>
                {categories.map(c => <option key={c}>{c}</option>)}
              </select>
              <input className="input" value={tagFilter} onChange={e=>setTagFilter(e.target.value)} placeholder="Tag (exact)"/>
              <select className="select" value={channelFilter} onChange={e=>setChannelFilter(e.target.value)}>
                <option value="">All channels</option>
                {DEFAULT_CHANNELS.map(c => <option key={c}>{c}</option>)}
              </select>
            </div>
          </div>
          {/* List */}
<div className="grid two">
  {filtered.length===0 && (
    <div className="card">
      <div className="card-body muted">No prompts match your filters.</div>
    </div>
  )}
  {filtered.map(it=>(
    <div className="card" key={it.id}>
      <div className="card-header">
        <div className="spread">
          <div>
            <div style={{fontSize:18, fontWeight:600}}>{it.name}</div>
            <div className="muted">{it.category} • Updated {new Date(it.updatedAt).toLocaleString()}</div>
          </div>
          <div className="hstack">
            <button className="button ghost" title="Copy full prompt" onClick={()=>navigator.clipboard.writeText(it.prompt)}>Copy</button>
            <button className="button ghost" title="Edit" onClick={()=>editItem(it)}>Edit</button>
            <button className="button ghost" title="Duplicate" onClick={()=>duplicateItem(it.id)}>Duplicate</button>
            <button className="button danger" title="Delete" onClick={()=>deleteItem(it.id)}>Delete</button>
          </div>
        </div>
      </div>
      <div className="card-body">
        <div className="muted" style={{marginBottom:8}}>{it.purpose}</div>

        {compact && !expandedIds.includes(it.id) ? (
          <div>
            <div className="clamp" style={{fontSize:14, fontFamily:'ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace'}}>{it.prompt}</div>
            <button className="button ghost" onClick={()=>toggleExpanded(it.id)}>Show more</button>
          </div>
        ) : (
          <div>
            <pre style={{whiteSpace:'pre-wrap', fontSize:14, margin:0}}>{it.prompt}</pre>
            {compact && <button className="button ghost" onClick={()=>toggleExpanded(it.id)}>Show less</button>}
          </div>
        )}

        {it.notes && <div className="muted" style={{marginTop:8}}>Notes: {it.notes}</div>}
        <div className="hstack-wrap" style={{marginTop:8}}>
          {(it.tags||[]).map(t => <span key={t} className="badge">{t}</span>)}
          {(it.channels||[]).map(c => <span key={c} className="badge">{c}</span>)}
        </div>
      </div>
    </div>
  ))}
</div>
          
          {/* Editor Modal */}
          {showEditor && editing && (
            <div className="modal-backdrop" onClick={(e)=>{ if(e.target.classList.contains('modal-backdrop')) { setShowEditor(false); setEditing(null);} }}>
              <div className="modal">
                <div className="card-header spread">
                  <div style={{fontWeight:600}}>{items.some(x=>x.id===editing.id) ? 'Edit Prompt' : 'New Prompt'}</div>
                  <button className="button" onClick={()=>{ setShowEditor(false); setEditing(null); }}>Close</button>
                </div>
                <div className="card-body grid" style={{gridTemplateColumns:'1fr 1fr'}}>
                  <div>
                    <label className="muted">Category</label>
                    <select className="select" value={editing.category} onChange={e=>setEditing({...editing, category: e.target.value})}>
                      {categories.map(c => <option key={c}>{c}</option>)}
                    </select>
                  </div>
                  <div>
                    <label className="muted">Name</label>
                    <input className="input" value={editing.name} onChange={e=>setEditing({...editing, name:e.target.value})} placeholder="e.g. IDV – Standard"/>
                  </div>
                  <div style={{gridColumn:'span 2'}}>
                    <label className="muted">Purpose</label>
                    <input className="input" value={editing.purpose} onChange={e=>setEditing({...editing, purpose:e.target.value})} placeholder="Why this exists"/>
                  </div>
                  <div style={{gridColumn:'span 2'}}>
                    <label className="muted">Prompt</label>
                    <textarea className="textarea" rows="7" value={editing.prompt} onChange={e=>setEditing({...editing, prompt:e.target.value})} placeholder="The actual text…"></textarea>
                  </div>
                  <div style={{gridColumn:'span 2'}}>
                    <label className="muted">Notes</label>
                    <textarea className="textarea" rows="3" value={editing.notes} onChange={e=>setEditing({...editing, notes:e.target.value})} placeholder="Compliance notes, when to use, etc."></textarea>
                  </div>
                  <div>
                    <label className="muted">Tags (comma separated)</label>
                    <input className="input" value={(editing.tags||[]).join(', ')} onChange={e=>setEditing({...editing, tags:e.target.value.split(',').map(s=>s.trim()).filter(Boolean)})} placeholder="intro, compliance, SMS"/>
                  </div>
                  <div>
                    <label className="muted">Channels</label>
                    <div className="hstack-wrap">
                      {DEFAULT_CHANNELS.map(c=>{
                        const checked = (editing.channels||[]).includes(c);
                        return (
                          <label key={c} className="chip-toggle">
                            <input type="checkbox" checked={checked} onChange={e=>{
                              const on = e.target.checked;
                              const next = on ? [ ...(editing.channels||[]), c ] : (editing.channels||[]).filter(x=>x!==c);
                              setEditing({...editing, channels: next});
                            }}/>
                            {c}
                          </label>
                        );
                      })}
                    </div>
                  </div>
                  <div style={{gridColumn:'span 2'}} className="hstack" >
                    <button className="button" onClick={()=>{ setShowEditor(false); setEditing(null); }}>Cancel</button>
                    <button className="button primary" onClick={saveEditing}>Save</button>
                  </div>
                </div>
              </div>
            </div>
          )}

          <div className="muted" style={{textAlign:'center', padding:'16px 0 32px'}}>
            Stored locally in your browser. Use Export to back up or share with teammates.
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
